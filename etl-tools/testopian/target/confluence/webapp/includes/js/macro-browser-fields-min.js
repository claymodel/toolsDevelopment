AJS.MacroBrowser.Field=function(d,b,c){c=c||{};var e=c.setValue||function(f){b.val(f)};var a=c.getValue||function(){return b.val()};b.change(c.onchange||AJS.MacroBrowser.paramChanged);return{paramDiv:d,input:b,setValue:e,getValue:a}};AJS.MacroBrowser.ParameterFields=(function(a){var b=function(g,f,e){if(f&&f.length){for(var c=0,d=f.length;c<d;c++){AJS.MacroBrowser.fields[f[c]]&&AJS.MacroBrowser.fields[f[c]].dependencyUpdated(g,e)}}};return{updateDependencies:b,username:function(f,d){if(f.multiple){return AJS.MacroBrowser.ParameterFields.string(f,d)}d=d||{};var e=AJS.clone("#macro-param-template");var c=AJS.$("input[type='text']",e);c.addClass("autocomplete-user").attr("data-none-message",AJS.I18n.getText("macro.browser.smartfields.not.found"));if(f.required){c.keyup(AJS.MacroBrowser.processRequiredParameters)}c.bind("selected.autocomplete-content",function(h,g){if(d.onselect){d.onselect(g.selection)}else{if(d.setValue){d.setValue(g.content.username)}else{b(f.name,d.dependencies,c.val());(typeof d.onchange=="function")&&d.onchange.apply(c)}}});AJS.Confluence.Binder.autocompleteUser(e);return AJS.MacroBrowser.Field(e,c)},spacekey:function(f,d){if(f.multiple){return AJS.MacroBrowser.ParameterFields.string(f,d)}d=d||{};var e=AJS.clone("#macro-param-template");var c=AJS.$("input[type='text']",e);c.addClass("autocomplete-space").attr("data-template","{key}").attr("data-none-message",AJS.I18n.getText("macro.browser.smartfields.not.found"));if(f.required){c.keyup(AJS.MacroBrowser.processRequiredParameters)}c.bind("selected.autocomplete-content",function(h,g){if(d.onselect){d.onselect(g.selection)}else{if(d.setValue){d.setValue(g.content.key)}else{b(f.name,d.dependencies,c.val());(typeof d.onchange=="function")&&d.onchange.apply(c)}}});AJS.Confluence.Binder.autocompleteSpace(e);return AJS.MacroBrowser.Field(e,c)},attachment:function(g,d){if(g.multiple){return AJS.MacroBrowser.ParameterFields.string(g,d)}var e=AJS.clone("#macro-param-select-template");var c=AJS.$("select",e);d=d||{};d.setValue=d.setValue||function(j){var h=false;c.find("option").each(function(){if(this.value==j){h=true;return false}});if(!h){c.append(AJS.$("<option/>").attr("value",j).text(j+" ("+AJS.I18n.getText("macro.browser.smartfields.not.found")+")"));c.tempValue=j}else{delete c.tempValue}try{c.val(j)}catch(i){AJS.log(i)}c.change()};var f=AJS.MacroBrowser.Field(e,c,d);f.updateDependencies=b;f.getData=function(j){if(!((j.title&&j.spaceKey)||j.pageId||j.draftId)){AJS.log("Not enough parameters to send attachmentsearch request");return}var i=c.tempValue||c.val();if(d.fileTypes){j.fileTypes=d.fileTypes}var h=AJS.params.contextPath+(j.draftId?"/json/draftattachmentsearch.action":"/json/attachmentsearch.action");a.getJSON(h,j,function(n){if(n.error){return}a("option",c).remove();var k=n.attachments;if(!k||!k.length){c.append(AJS.$("<option/>").attr("value","").html(AJS.I18n.getText("macro.browser.smartfields.no.attachments")));if(c.tempValue){d.setValue(c.tempValue)}}else{for(var l=0,m=k.length;l<m;l++){c.append(AJS.$("<option/>").attr("value",k[l].name).text(k[l].name))}i=i||c.tempValue;d.setValue(i||k[0].name)}})};return f},"confluence-content":function(g,d){if(g.multiple){return AJS.MacroBrowser.ParameterFields.string(g,d)}d=d||{};g.options=g.options||{};var f=AJS.clone("#macro-param-template"),c=AJS.$("input[type='text']",f).attr("data-none-message",AJS.I18n.getText("macro.browser.smartfields.not.found")).attr("data-template","");if(g.required){c.keyup(AJS.MacroBrowser.processRequiredParameters)}d.onchange=d.onchange||function(h){var i=c.val();b(g.name,d.dependencies,i)};d.setValue=d.setValue||function(h){c.val(h);(typeof d.onchange=="function")&&d.onchange.apply(c)};c.bind("selected.autocomplete-content",function(m,k){var h="";if(g.options.includeDatePath=="true"&&k.content.type=="blogpost"){var l=k.content.createdDate.date.split("-");h="/"+l[0]+"/"+l[1]+"/"+l[2].substring(0,2)+"/"}var j=k.content.space&&k.content.space.key,i=((j&&j!=AJS.params.spaceKey)?(j+":"):"")+h+k.content.title;c.val(i);if(d.onselect){d.onselect(k.selection)}else{d.setValue(i,c)}});if(g.options.spaceKey){if(g.options.spaceKey.toLowerCase()=="@self"){g.options.spaceKey=AJS.params.spaceKey}c.attr("data-spacekey",g.options.spaceKey)}var e=g.options.type;if(typeof e=="string"){if(e=="page"){c.addClass("autocomplete-page");AJS.Confluence.Binder.autocompletePage(f)}else{if(e=="blogpost"){c.addClass("autocomplete-blogpost");AJS.Confluence.Binder.autocompleteBlogpost(f)}else{if(e=="attachment"){c.addClass("autocomplete-attachment");AJS.Confluence.Binder.autocompleteAttachment(f)}}}}else{c.addClass("autocomplete-confluence-content");AJS.Confluence.Binder.autocompleteConfluenceContent(f)}return AJS.MacroBrowser.Field(f,c,d)},string:function(f,d){var e=AJS.clone("#macro-param-template");var c=a("input",e);if(f.required){c.keyup(AJS.MacroBrowser.processRequiredParameters)}return AJS.MacroBrowser.Field(e,c,d)},"boolean":function(f,d){var e=AJS.clone("#macro-param-checkbox-template");var c=a("input",e);d=d||{};d.setValue=d.setValue||function(g){if(/true/i.test(g)||(/true/i.test(f.defaultValue)&&!(/false/i).test(g))){c.attr("checked","checked")}};return AJS.MacroBrowser.Field(e,c,d)},"enum":function(f,d){if(f.multiple){return AJS.MacroBrowser.ParameterFields.string(f,d)}var e=AJS.clone("#macro-param-select-template");var c=a("select",e);if(!(f.required||f.defaultValue)){c.append(AJS.$("<option/>").attr("value",""))}a(f.enumValues).each(function(){c.append(AJS.$("<option/>").attr("value",this).html(""+this))});return AJS.MacroBrowser.Field(e,c,d)},_hidden:function(f,d){var e=AJS.clone("#macro-param-hidden-template").hide();var c=a("input",e);return AJS.MacroBrowser.Field(e,c,d)}}})(AJS.$);