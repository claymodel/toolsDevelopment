if(!Control){var Control={}}Control.Slider=Class.create();Control.Slider.prototype={initialize:function(d,a,b){this.handle=$(d);this.track=$(a);this.options=b||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step)||1;this.value=0;var c=Math.round(this.track.offsetWidth/this.increment);if(this.isVertical()){c=Math.round(this.track.offsetHeight/this.increment)}this.maximum=this.options.maximum||c;this.minimum=this.options.minimum||0;this.alignX=parseInt(this.options.alignX)||0;this.alignY=parseInt(this.options.alignY)||0;this.setCurrentLeft(Position.cumulativeOffset(this.track)[0]-Position.cumulativeOffset(this.handle)[0]+this.alignX);this.setCurrentTop(this.trackTop()-Position.cumulativeOffset(this.handle)[1]+this.alignY);this.offsetX=0;this.offsetY=0;this.originalLeft=this.currentLeft();this.originalTop=this.currentTop();this.originalZ=parseInt(this.handle.style.zIndex||"0");this.setSliderValue(parseInt(this.options.sliderValue)||0);this.active=false;this.dragging=false;this.disabled=false;this.handleImage=$(this.options.handleImage)||false;this.handleDisabled=this.options.handleDisabled||false;this.handleEnabled=false;if(this.handleImage){this.handleEnabled=this.handleImage.src||false}if(this.options.disabled){this.setDisabled()}this.values=this.options.values||false;Element.makePositioned(this.handle);this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress)},dispose:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress)},setDisabled:function(){this.disabled=true;if(this.handleDisabled){this.handleImage.src=this.handleDisabled}},setEnabled:function(){this.disabled=false;if(this.handleEnabled){this.handleImage.src=this.handleEnabled}},currentLeft:function(){return parseInt(this.handle.style.left||"0")},currentTop:function(){return parseInt(this.handle.style.top||"0")},setCurrentLeft:function(a){this.handle.style.left=a+"px"},setCurrentTop:function(a){this.handle.style.top=a+"px"},trackLeft:function(){return Position.cumulativeOffset(this.track)[0]},trackTop:function(){return Position.cumulativeOffset(this.track)[1]},getNearestValue:function(c){if(this.values){var a=0;var e=Math.abs(this.values[0]-c);var d=this.values[0];for(a=0;a<this.values.length;a++){var b=Math.abs(this.values[a]-c);if(b<e){d=this.values[a];e=b}}return d}return c},setSliderValue:function(b){b=this.getNearestValue(b);if(b>this.maximum){b=this.maximum}if(b<this.minimum){b=this.minimum}var a=(b-(this.value||this.minimum))*this.increment;if(this.isVertical()){this.setCurrentTop(a+this.currentTop())}else{this.setCurrentLeft(a+this.currentLeft())}this.value=b;this.updateFinished()},minimumOffset:function(){return(this.isVertical()?this.trackTop()+this.alignY:this.trackLeft()+this.alignX)},maximumOffset:function(){return(this.isVertical()?this.trackTop()+this.alignY+(this.maximum-this.minimum)*this.increment:this.trackLeft()+this.alignX+(this.maximum-this.minimum)*this.increment)},isVertical:function(){return(this.axis=="vertical")},startDrag:function(b){if(Event.isLeftClick(b)){if(!this.disabled){this.active=true;var c=[Event.pointerX(b),Event.pointerY(b)];var a=Position.cumulativeOffset(this.handle);this.offsetX=(c[0]-a[0]);this.offsetY=(c[1]-a[1]);this.originalLeft=this.currentLeft();this.originalTop=this.currentTop()}Event.stop(b)}},update:function(b){if(this.active){if(!this.dragging){var a=this.handle.style;this.dragging=true;if(a.position==""){a.position="relative"}a.zIndex=this.options.zindex}this.draw(b);if(navigator.appVersion.indexOf("AppleWebKit")>0){window.scrollBy(0,0)}Event.stop(b)}},draw:function(c){var d=[Event.pointerX(c),Event.pointerY(c)];var b=Position.cumulativeOffset(this.handle);b[0]-=this.currentLeft();b[1]-=this.currentTop();d[0]-=this.offsetX;d[1]-=this.offsetY;var a=this.handle.style;if(this.isVertical()){if(d[1]>this.maximumOffset()){d[1]=this.maximumOffset()}if(d[1]<this.minimumOffset()){d[1]=this.minimumOffset()}if(this.values){this.value=this.getNearestValue(Math.round((d[1]-this.minimumOffset())/this.increment)+this.minimum);d[1]=this.trackTop()+this.alignY+(this.value-this.minimum)*this.increment}else{this.value=Math.round((d[1]-this.minimumOffset())/this.increment)+this.minimum}a.top=d[1]-b[1]+"px"}else{if(d[0]>this.maximumOffset()){d[0]=this.maximumOffset()}if(d[0]<this.minimumOffset()){d[0]=this.minimumOffset()}if(this.values){this.value=this.getNearestValue(Math.round((d[0]-this.minimumOffset())/this.increment)+this.minimum);d[0]=this.trackLeft()+this.alignX+(this.value-this.minimum)*this.increment}else{this.value=Math.round((d[0]-this.minimumOffset())/this.increment)+this.minimum}a.left=(d[0]-b[0])+"px"}if(this.options.onSlide){this.options.onSlide(this.value)}},endDrag:function(a){if(this.active&&this.dragging){this.finishDrag(a,true);Event.stop(a)}this.active=false;this.dragging=false},finishDrag:function(a,b){this.active=false;this.dragging=false;this.handle.style.zIndex=this.originalZ;this.originalLeft=this.currentLeft();this.originalTop=this.currentTop();this.updateFinished()},updateFinished:function(){if(this.options.onChange){this.options.onChange(this.value)}},keyPress:function(a){if(this.active&&!this.disabled){switch(a.keyCode){case Event.KEY_ESC:this.finishDrag(a,false);Event.stop(a);break}if(navigator.appVersion.indexOf("AppleWebKit")>0){Event.stop(a)}}}};