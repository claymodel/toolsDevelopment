AJS.toInit(function(e){if(!AJS.params.linkToThisPageLink){return}var d=new AJS.Dialog(600,210,"link-page-popup").addHeader(AJS.params.linkToThisPageHeading).addPanel(AJS.params.linkToThisPageHeading,"<form id='link-page-popup-form' class='aui'><fieldset></fieldset></form>").addCancel(AJS.params.linkToThisPageClose,function(g){f(g)});if(Confluence.KeyboardShortcuts.enabled||AJS.Data.get("use-keyboard-shortcuts")=="true"){d.addHelpText(AJS.params.shortcutDialogTip,{shortcut:"k"})}var a=function(g){if(g.which==27){f(d)}};var b=[{label:AJS.params.linkToThisPageLink,id:"link",value:e("link[rel=canonical]").attr("href")},{label:AJS.params.linkToThisPageTinyLink,id:"tiny-link",value:e("link[rel=shortlink]").attr("href")},{label:AJS.params.linkToThisPageWikiMarkup,id:"wiki-markup",value:e("meta[name=wikilink]").attr("content")}];e.each(b,function(){e("#link-page-popup-form fieldset").append(AJS.format("<div class='field-group'><label for=''link-popup-field-{0}''>{1}:</label><input id=''link-popup-field-{0}'' readonly=''readonly'' value='''' class=''text'' type=''text''></div>",this.id,this.label)).find("input:last").val(this.value)});var f=function(g){g.hide();e(document).unbind("keydown",a)};e("#link-to-page-link").click(function(g){if(!e("#link-to-page-fields")[0]){alert("Due to customisations made to this space's layout, Confluence is unable to load the links dialog. For details on how to correct this, please visit the 'Upgrading Custom Layouts' page in our Confluence Documentation, or contact your administrators.");return}e(this).parents(".ajs-drop-down")[0].hide();d.show();e(document).keydown(a);e("#link-page-popup-form #link-popup-field-tiny-link").select();return AJS.stopEvent(g)});var c=e("#link-page-popup-form fieldset input.text");c.focus(function(){e(this).select()});c.mouseup(function(g){g.preventDefault()})});