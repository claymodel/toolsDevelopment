(function(e){var d=function(g){AJS.log("InputDrivenDropDown: truncating text");var i=g.$.closest(".aui-dd-parent").width(),h=20;e("a span:not(.icon)",g.$).each(function(){var k=e(this),j=AJS("var","&#8230;"),m=j.width(),l=false;k.wrapInner(e("<em>"));e("em",k).each(function(){var n=e(this);n.show();if(this.offsetLeft+this.offsetWidth+m>i-h){var u=this.childNodes,t=false;for(var p=u.length-1;p>=0;p--){var q=u[p],o=1,s=(q.nodeType==3)?"nodeValue":"innerHTML",r=q[s];do{if(o<=r.length){q[s]=r.substr(0,r.length-o++)}else{break}}while(this.offsetLeft+this.offsetWidth+m>i-h);if(o<=r.length){t=true;break}}if(t){l=true}else{n.hide()}}});if(l){k.append(j);this.elpss=j}})};var b=function(g,m){if(!m.length||!m[0]){return}AJS.log("InputDrivenDropDown: highlighting tokens");for(var j=0,k=m.length;j<k;j++){var h=m[j];m[j]=h?h.replace(/[\.\*\+\?\|\(\)\[\]{}\\]/g,"\\$"):""}var l=new RegExp("("+m.join("|")+")","gi");e("li a:not(.dropdown-prevent-highlight) span",g.$).each(function(){var n=e(this),i=n.html().replace(l,"<strong>$1</strong>");n.html(i)})};var c=function(g){AJS.log("InputDrivenDropDown: add space names");e("a span:not(.icon)",g.$).each(function(){var j=e(this);var h;try{h=AJS.dropDown.getAdditionalPropertyValue(j,"spaceName")}catch(i){AJS.log("Problem getting space name: "+i.message)}var k=j.text();if(h){k+=" ("+AJS("i").html(h).text()+")"}j.attr("title",k)})};var f=function(k,h){var j=k.options,i=k.dd;if(i){i.hide();i.$.remove()}j.ajsDropDownOptions=j.ajsDropDownOptions||{};if(j.ajsDropDownOptions&&!j.ajsDropDownOptions.alignment){j.ajsDropDownOptions.alignment="left"}j.ajsDropDownOptions.selectionHandler=j.ajsDropDownOptions.selectionHandler||function(m,l){if(m.type!="click"){m.preventDefault();e("a",l).click();document.location=e("a",l).attr("href")}};var g=k.dd=AJS.dropDown(h.matrix,j.ajsDropDownOptions)[0];if(j.ajsDropDownOptions&&j.ajsDropDownOptions.className){g.$.addClass(j.ajsDropDownOptions.className)}if(j.dropdownPlacement){j.dropdownPlacement(g.$)}else{AJS.log("No dropdownPlacement function specified. Appending dropdown to the body.");e("body").append(g.$)}b(g,h.queryTokens||[h.query]);d(g);c(g);if(j.dropdownPostprocess){j.dropdownPostprocess(g.$)}g.show(k._effect);if(typeof j.onShow=="function"){j.onShow.call(g,g.$)}return g};function a(h,g){this._effect="appear";this._timer=null;this.id=h;this.options=g;this.inactive=false;this.busy=false;this.cacheManager=AJS.Confluence.cacheManager()}a.prototype.clearCache=function(){this.cacheManager.clear()};a.prototype.change=function(i,h){var g=this;if(i!=g._value){g._value=i;g.busy=false;clearTimeout(g._timer);if(h||(/\S{2,}/).test(i)){var j=g.cacheManager.get(i);if(j){f(g,j)}else{g.busy=true;g._timer=setTimeout(function(){g.options.getDataAndRunCallback.call(g,i,g.show)},200)}}else{g.dd&&g.dd.hide()}}};a.prototype.hide=function(){this.dd&&this.dd.hide()};a.prototype.remove=function(){var g=this.dd;if(g){this.hide();g.$.remove()}this.inactive=true;this.options.onDeath&&this.options.onDeath()};a.prototype.show=function(h,j,i){if(this.inactive){AJS.log("Quick search abandoned before server response received, ignoring. "+this);return}var g={matrix:h,query:j,queryTokens:i};this.cacheManager.put(j,g);f(this,g);this.busy=false};AJS.inputDrivenDropdown=function(g){return new a("inputdriven-dropdown",g)}})(jQuery);