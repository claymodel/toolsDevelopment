(function(){var b=AJS.$;var a=function(f){if(!f||!f.group){throw new Error("Invalid JSON format")}var e=[];for(var g=0,h=f.group.length;g<h;g++){e.push(f.group[g].result)}return e};var d=function(o,i,f,g){var n=b(o),s="data-autocomplete-content-bound";if(n.attr(s)){return}if(typeof i=="string"){i=[i]}n.attr(s,"true").attr("autocomplete","off");var p=i.join(","),h=n.attr("data-max")||10,m=n.attr("data-alignment")||"left",l=n.attr("data-spacekey"),k=n.attr("data-none-message"),r=n.attr("data-template")||f,e=n.attr("data-target"),j=n.attr("data-dropdown-target"),q=null;if(j){q=b(j)}else{q=b("<div></div>");n.after(q)}q.addClass("aui-dd-parent autocomplete");n.quicksearch(AJS.REST.getBaseUrl()+"search/name.json",null,{onShow:function(){n.trigger("open.autocomplete-content",{contentTypes:i})},makeParams:function(u){var t={"max-results":h,type:p,query:u};if(l){t.spaceKey=l}return t},dropdownPlacement:function(t){q.append(t)},makeRestMatrixFromData:a,addDropdownData:function(t){if(!t.length){if(k){t.push([{name:k,className:"no-results",href:"#"}])}}return t},ajsDropDownOptions:{alignment:m,displayHandler:g,selectionHandler:function(w,u){if(u.find(".search-for").length){n.trigger("selected.autocomplete-content",{contentTypes:i,searchFor:n.val()});return}if(u.find(".no-results").length){AJS.log("no results selected");this.hide();w.preventDefault();return}var t=u.data("properties");n.val(AJS.template(r).fillHtml(t.restObj));if(e){var v=AJS.template(f).fillHtml(t.restObj);b(e).val(v)}n.trigger("selected.autocomplete-content",{contentTypes:i,content:t.restObj,selection:u});this.hide();w.preventDefault()}}})};AJS.Confluence.Binder.autocompleteSpace=function(e){e=e||document.body;b("input.autocomplete-space",e).each(function(){d(this,["spacedesc","personalspacedesc"],"{name}",function(f){return f.name})})};AJS.Confluence.Binder.autocompleteAttachment=function(e){e=e||document.body;b("input.autocomplete-attachment",e).each(function(){d(this,"attachment","{fileName}",function(f){var g=(f.restObj&&f.restObj.fileName)||f.name;if(f.restObj&&f.restObj.space&&f.restObj.space.title){g+=" ("+f.restObj.space.title+")"}return g})})};var c=function(e){return(e.restObj&&e.restObj.title)||e.name};AJS.Confluence.Binder.autocompletePage=function(e){e=e||document.body;b("input.autocomplete-page",e).each(function(){d(this,"page","{title}",c)})};AJS.Confluence.Binder.autocompleteBlogpost=function(e){e=e||document.body;b("input.autocomplete-blogpost",e).each(function(){d(this,"blogpost","{title}",c)})};AJS.Confluence.Binder.autocompleteConfluenceContent=function(e){e=e||document.body;b("input.autocomplete-confluence-content",e).each(function(){d(this,["page","blogpost"],"{title}",c)})}})();