(function(d){var b=function(h,j){var f=d(".aui-tip-parent");f=AJS.$('<div class="aui-tip-parent"></div>');var l=-11,g=h.height();if(AJS.$.browser.msie){l=(parseInt(AJS.$.browser.version,10)<8)?-5:-13}var e=j?14:6;h.prepend(f).css({zIndex:3001});var i=Raphael(f[0],12,e),k=i.path("M0,6l6-6,6,6").attr({fill:"#f0f0f0",stroke:"#e2e2e2"});i.canvas.style.zIndex=3000;tip=i;if(j){k.rotate(180);k.clone().translate(3,2).attr({fill:"#000",stroke:"#000",opacity:".2"}).toBack();l=l+h.outerHeight()+10}f.css({top:l,left:10});return i};var c=function(e){return Raphael.shadow(0,0,e.outerWidth(true),e.outerHeight(true),{radius:5,target:e[0],offset:2})};var a=function(f,e){e=e||{};setTimeout(function(){var j=AJS.Editor.Adapter.offset(f.anchor),o=f.panel.width()+j.left-d(window).width()+10,r=7,g=0,h=d(f.anchor).outerHeight(),n,i=j.left-(o>0?o:0)-g;if(f.options.shouldFlip){n=j.top-r-f.panel.outerHeight()-4}else{n=j.top+r+h}if(f.options.anchorIframe){var q=d(f.options.anchorIframe),m=q.offset().top+q.height();n=Math.min(n,m)}f.panel.find(".aui-tip-parent").css({left:Math.abs(j.left-i)+10});var l={top:n,left:i},p=f.panel.add(f.shadow),k=function(){f.shadow.css("left",f.panel.position().left-1)};e.animate?p.animate(l,e.animateDuration,k):(function(){p.css(l);k()})()},e.delay||0)};AJS.Confluence.PropertyPanel={current:null,createFromButtonModel:function(m,f,l,p){var e=AJS("div").attr({"class":"panel-buttons"});for(var h=0,o=l.length;h<o;h++){if(!l[h]){continue}var k=l[h],j=k.html||'<span class="icon"></span><span class="panel-button-text">'+(k.text||"")+"</span>",g=[];k.className&&g.push(k.className);k.disabled&&g.push("disabled");k.selected&&g.push("selected");!l[h+1]&&g.push("last");!l[h-1]&&g.push("first");var n=AJS("a").attr({href:l[h].href||"#","class":g.join(" ")}).html(j);l[h].tooltip&&n.attr("title",l[h].tooltip);if(k.disabled){n.attr("title",k.disabledText);n.disable();n.click(function(i){return AJS.stopEvent(i)})}else{l[h].click&&(function(q,i,r){i.click(function(s){q.click(i,r);return AJS.stopEvent(s)})})(l[h],n,f)}e.append(n)}return this.create(m,f,e,p)},create:function(i,f,h,m){m=m||{};AJS.Editor.Adapter.storeCurrentSelectionState();var k=d("#property-panel"),e;k.length&&this.destroy();k=AJS("div").addClass("aui-property-panel-parent").addClass(i+"-panel").attr("id","property-panel").appendTo("body");e=AJS("div").addClass("aui-property-panel").append(h);k.append(e).css({top:0,left:-10000});var g=this;h.find(".last:last").css({margin:0});var l=c(k),j=b(k,m.shouldFlip);this.current={anchor:f,panel:k,hasAnchorChanged:function(n){return n&&g.hasAnchorChanged(n)},snapToElement:function(n){a(this,n)},shadow:l,tip:j,options:m,updating:true};a(this.current);e=this.current;AJS.$(document).bind("keydown.property-panel.escape",function(n){if(n.keyCode===27){AJS.Confluence.PropertyPanel.destroy()}});AJS.$(document).bind("click.property-panel",function(n){if(!AJS.$(n.target).closest("#property-panel").length){AJS.Confluence.PropertyPanel.destroy()}});AJS.trigger("created.property-panel",this.current);this.current.updating=false;return this.current},destroy:function(){if(!this.current){AJS.log("PropertyPanel.destroy: called with no current PropertyPanel, returning");return}if(this.current.updating){AJS.log("PropertyPanel.destroy: called while updating, returning");return}AJS.trigger("destroyed.property-panel",this.current);AJS.$(document).unbind(".property-panel");this.current.panel.remove();this.current.shadow.remove();this.current=null},hasAnchorChanged:function(e){var f=this.current;if(f&&d(f.anchor)[0]==d(e)[0]){return(!f.options.originalHeight||(f.options.originalHeight==d(e).height()))}return false}}})(AJS.$);