AJS.PagePermissions.Controls=function(b){var d=AJS.$;var c={handleNonExistentEntityNames:function(g){if(!g||!g.length){return}var f=g.join(", ");var h=AJS.I18n.getText("page.perms.error.invalid.entity.names")+" "+f;d("#page-permissions-error-div").find("div").text(h).end().removeClass("hidden");b.refreshLayout()},isDuplicateEntityForType:function(f,h){var g=d("#page-permissions-table ."+h+"-permission-row .permission-entity-name").filter(function(){return d(this).text()==f.name});return g.length>0},resetValidationErrors:function(){d("#page-permissions-error-div").addClass("hidden");b.refreshLayout()}};var a=(function(){var f=d("#page-permissions-names-input");var i=d("#page-permissions-names-hidden");var h=f.val();var g="input-placeholder";f.keypress(function(j){if(j.keyCode==Event.KEY_RETURN){e();f.focus();return false}return true});f.quicksearch("/json/contentnamesearch.action?type=userinfo",null,{dropdownPostprocess:function(j){d("ol.last",j).remove();if(d("ol",j).length==0){j.append(AJS.renderTemplate("permissions-username-no-suggestion-template"))}},dropdownPlacement:function(k){var j=AJS("div");j.addClass("page-perms-name-dropdown-wrapper aui-dd-parent");j.append(k);f.after(j)},ajsDropDownOptions:{selectionHandler:function(l,k){if(k.hasClass("message")){return}var j=d.data(k.find("span")[0],"properties");var m=j.href.substr(j.href.lastIndexOf("/")+2);i.val(unescape(m.replace(/\+/g," ")));f.val("");e();this.hide();l.preventDefault()}}});f.focus(function(){if(f.hasClass(g)){f.removeClass(g).val("")}var l=f.next(".aui-dd-parent");if(!l.length){return}l.show();var j=f.offset().left;if(l.offset().left!=j){l.css("margin-left",0);var n=j-l.offset().left;l.css("margin-left",n+"px")}var m=f.offset().top+f.outerHeight();if(l.offset().top!=m){l.css("margin-top",0);var k=m-l.offset().top;l.css("margin-top",k+"px")}l.css({width:f.outerWidth()});l.hide()});f.blur(function(){if(f.val()==""){f.addClass(g).val(h)}});return{getValue:function(){var j=i.val();if(j){i.val("")}else{j=f.val();if(j==h){j=""}}return j},addPlaceholder:function(){f.addClass(g).val(h)},removeFromNameInput:function(m){if(!m){return}var l=f.val();if(!l){return}var j=l.split(",");for(var k=0;k<j.length;k++){j[k]=d.trim(j[k])}j=d.grep(j,function(n){return n!=""&&n!=m});if(j.length){f.val(j.join(", "))}else{if(document.activeElement==f[0]){f.val("")}else{this.addPlaceholder()}}}}})();var e=function(){c.resetValidationErrors();b.table.clearHighlight();var f=a.getValue();if(!f){return}b.addNames(f)};d("#page-permissions-choose-me").click(function(f){c.resetValidationErrors();b.addNames(d(this).find(".remote-user-name").text());return AJS.stopEvent(f)});d("#permissions-error-div-close").click(function(f){c.resetValidationErrors();return AJS.stopEvent(f)});d("#add-typed-names").click(e);return{validator:c,nameField:a,setVisible:function(f){AJS.setVisible("#page-permissions-editor-form",f);AJS.setVisible(".remove-permission-link",f);if(f){a.addPlaceholder()}},isShowing:function(){return !d("#page-permissions-editor-form").hasClass("hidden")},getPermissionType:function(){return !!d("#restrictViewRadio:checked").length?"view":"edit"}}};