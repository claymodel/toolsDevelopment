(function(a){a(function(){a(".avataror").each(function(){var c=a(this);var d=a("img",this).attr("src");c.css({"-moz-border-radius":"10px","-webkit-border-radius":"10px","border-radius":"10px"});c.html("<p>Loadingâ€¦</p>");var b={previewSize:64};b.preview=a("<div/>").css({border:"solid 1px #000","float":"left",height:"64px",overflow:"hidden",width:"64px",position:"relative",top:"-9999em",left:"-9999em"});c.append(b.preview);b.img=a('<img src="'+d+'" alt="Avatar Source"/>');b.img.load(function(){b.image=a("<div/>").css({background:"url('"+d+"') no-repeat",clear:"left",position:"relative"});b.marker=a("<div/>").css({cursor:"move",position:"relative"});b.dash=a("<div/>");b.shadow=a("<div/>");b.dash.add(b.shadow).css({cursor:"move",opacity:0.5,left:0,top:0,position:"absolute"});b.image.append(b.shadow).append(b.dash).append(b.marker);c.append(b.image);b.marker.html("<div></div><div></div><div></div><div></div>");a("div",b.marker).each(function(e){var f=a(this);f.css({background:"#000",border:"solid 1px #fff",width:"10px",height:"10px",position:"absolute","font-size":"1px"});f.css(["left","right","right","left"][e],"-6px");f.css(["top","top","bottom","bottom"][e],"-6px");f.css("cursor",["nw-resize","ne-resize","se-resize","sw-resize"][e]);f.mousedown(function(g){g.preventDefault();g.stopPropagation();b.dragging={x:g.pageX,y:g.pageY,ax:b.x,ay:b.y,w:b.width,h:b.height,i:e+1};b.shadow.hide()})});b.marker.add(b.image).mousedown(function(f){f.preventDefault();b.dragging={x:f.pageX,y:f.pageY,ax:b.x,ay:b.y,w:b.width,h:b.height};b.shadow.hide()}).mousemove(function(j){if(b.dragging){var h=j.pageX-b.dragging.x;var g=j.pageY-b.dragging.y;b.x=b.dragging.ax+h;b.y=b.dragging.ay+g;console.log([b.x,b.width,b.imgwidth]);console.log([b.y,b.height,b.imgheight]);if(b.x+b.width>b.imgwidth){b.x=b.imgwidth-b.width}if(b.y+b.height>b.imgheight){b.y=b.imgheight-b.height}if(b.x<0){b.x=0}if(b.y<0){b.y=0}var f;var i=[0,1,-1,-1,1];var k=[0,1,1,-1,-1];if(b.dragging.i){f=(Math.abs(h)<Math.abs(g)?k[b.dragging.i]*g:i[b.dragging.i]*h);b.width=b.height=b.dragging.w-f;if(b.width<20){b.width=b.height=20}b.x=b.dragging.ax+(b.dragging.w-b.width)*(1+i[b.dragging.i])/2;b.y=b.dragging.ay+(b.dragging.h-b.height)*(1+k[b.dragging.i])/2;if(b.x+b.width>b.imgwidth){b.width=b.height=b.imgwidth-b.x}if(b.y+b.height>b.imgheight){b.width=b.height=b.imgheight-b.y}}b.setMarker()}}).mouseup(function(f){a("#avatar-offsetX").val(b.x);a("#avatar-offsetY").val(b.y);a("#avatar-width").val(b.width);b.dragging=null;b.shadow.show()});b.imgwidth=b.img.width();b.imgheight=b.img.height();b.x=a("#avatar-offsetX").val()*1;b.y=a("#avatar-offsetY").val()*1;b.width=a("#avatar-width").val()*1;b.height=b.width;b.image.css({width:b.imgwidth+"px",height:b.imgheight+"px"});b.setMarker();c.css({width:b.imgwidth+"px"});b.preview.css({margin:"0 0 10px "+Math.round(b.imgwidth/2-b.previewSize/2)+"px",position:"static"});a("p",c).remove()});b.preview.append(b.img);b.setMarker=function(){this.marker.css("border","dashed 1px #fff");this.dash.css("border","solid 1px #000");this.shadow.css("border","solid 1px #000");this.marker.add(this.dash).css("left",this.x-1+"px");this.marker.add(this.dash).css("top",this.y-1+"px");this.shadow.css("border-left-width",this.x+"px");this.shadow.css("border-right-width",this.imgwidth-this.x-this.width+"px");this.shadow.css("border-top-width",this.y+"px");this.shadow.css("border-bottom-width",this.imgheight-this.y-this.height+"px");this.shadow.css("width",this.width+"px");this.shadow.css("height",this.height+"px");this.marker.add(this.dash).css("width",this.width+"px");this.marker.add(this.dash).css("height",this.height+"px");this.img.attr("width",this.imgwidth*this.previewSize/this.width);this.img.attr("height",this.imgheight*this.previewSize/this.height);this.img.css("margin-left","-"+this.x*this.previewSize/this.width+"px");this.img.css("margin-top","-"+this.y*this.previewSize/this.height+"px");this.preview.select()}})})})(jQuery);