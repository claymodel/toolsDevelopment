AJS.toInit(function(c){var d=function(t){t=c.extend({spaceKey:AJS.params.spaceKey,spaceName:AJS.params.spaceName,parentPageTitle:AJS.params.parentPageTitle,title:AJS.params.movePageDialogViewPageTitle,buttonName:AJS.params.movePageDialogMoveButton,moveHandler:function(u){AJS.log("No move handler defined. Closing dialog.");u.remove()},cancelHandler:function(u){u.remove()},pageTitleAccessor:function(){return AJS.params.pageTitle}},t);var s={spaceKey:t.spaceKey,spaceName:t.spaceName,parentPageTitle:t.parentPageTitle};var o=t.spaceKey;var h=t.spaceName;var p=t.parentPageTitle;var q="";var k="";var e=function(u,v){q=u;k=v};var i=AJS.ConfluenceDialog({width:800,height:590,id:"move-page-dialog"});i.addHeader(t.title);i.addPanel(AJS.params.movePageDialogLocationPanel,AJS.renderTemplate("movePageDialog"),"location-panel","location-panel-id");i.addPanel(AJS.params.movePageDialogSearchPanel,AJS.renderTemplate("movePageSearchPanel"),"search-panel","search-panel-id");i.addPanel(AJS.params.movePageDialogHistoryPanel,AJS.renderTemplate("movePageHistoryPanel"),"history-panel","history-panel-id");i.addPanel(AJS.params.movePageDialogBrowsePanel,AJS.renderTemplate("movePageBrowsePanel"),"browse-panel","browse-panel-id");i.get("panel:0")[0].onselect=function(){c("#new-space-key").val(o);c("#new-space").val(h);c("#new-parent-page").val(p).select()};i.get("panel:1")[0].onselect=function(){c("#move-page-dialog .search-panel .search-results .selected").removeClass("selected");c("#move-page-dialog input.search-query").focus()};i.get("panel:0").select();gotoReorderPage=function(v){v.nextPage();var u=c("#move-page-dialog");c(".ordering-panel",u).movePageOrdering(o,p,t.pageTitleAccessor(),e)};moveFunction=function(v){var x=c("#new-space:visible").val();var w=c("#new-space-key").val();var u=c("#new-parent-page:visible").val();if(x&&(x!=h||w!=o||u!=p)){AJS.MoveDialog.getBreadcrumbs({spaceKey:w,pageTitle:u},function(){t.moveHandler(v,w,x,u,q,k,m)},function(y){c("#new-parent-breadcrumbs").html(AJS.renderTemplate("movePageBreadcrumbError"));if(y.status==404){r.error(AJS.params.movePageDialogLocationNotFound)}})}else{t.moveHandler(v,o,h,p,q,k,m)}};executeMove=function(u){if(c("#reorderCheck")[0].checked){gotoReorderPage(u)}else{moveFunction(u)}};i.addButton(t.buttonName,executeMove,"move-button");i.addCancel(AJS.I18n.getText("cancel.name"),t.cancelHandler);i.popup.element.find(".dialog-title").append(AJS.template.load("move-help-link"));i.addPage().addHeader(t.title).addPanel(AJS.params.movePageDialogOrderingTitle,AJS.renderTemplate("orderingPagePanel"),"ordering-panel","ordering-panel-id").addLink(AJS.params.movePageDialogBackButton,function(u){u.prevPage()},"dialog-back-link").addButton(AJS.params.movePageDialogMoveAndOrderButton,moveFunction,"reorder-button").addCancel(AJS.params.movePageDialogCancelButton,t.cancelHandler);var g=i.get("button#"+t.buttonName)[0].item;c("button.move-button").before(AJS.renderTemplate("reorderCheckbox"));i.gotoPage(0);i.show();var n=c("#move-page-dialog");c(".location-panel .location-info",n).appendTo(c(".dialog-page-body:first",n));c(".dialog-button-panel:visible",n).prepend(AJS.renderTemplate("movePageErrors"));var f=new AJS.MoveDialog.Breadcrumbs(c("#new-parent-breadcrumbs"));function m(u){if(!u||u.length==0){c("#move-errors").addClass("hidden");c(g).attr("disabled","");return}if(!c.isArray(u)){u=[u]}c("#move-errors").text(u[0]).attr("title",u.join("\n")).removeClass("hidden");i.gotoPage(0)}var r={moveButton:g,clearErrors:function(){m([])},error:m,select:function(w,v,u){AJS.log("select: "+[w,v,u].join());o=w;h=v;p=u||"";c(g).attr("disabled","disabled");f.update({spaceKey:o,title:p},r)}};var j=AJS.params.parentPageTitle!=""?AJS.params.parentPageTitle:AJS.params.fromPageTitle;var l=new AJS.MoveDialog.Breadcrumbs(c("#current-parent-breadcrumbs"));l.update({spaceKey:AJS.params.spaceKey,title:j},r);c(".location-panel",n).movePageLocation(r);c(".search-panel",n).movePageSearch(r);c(".history-panel",n).movePageHistory(r);i.get("panel:2")[0].onselect=function(){c(".history-panel",n).movePageHistory(r)};i.get("panel:3")[0].onselect=function(){AJS.log("browse: "+[o,h,p].join());c(".browse-panel",n).movePageBrowse(r,o,h,p,j,t.pageTitleAccessor())};c("#new-parent-page").select();return n};var b=function(g,f,h,e){var i={pageId:AJS.params.pageId,spaceKey:g};if(h){i.position=e;i.targetId=h}else{if(f!=""){i.targetTitle=f;i.position="append"}else{i.position="topLevel"}}return i};function a(i,k,e,l,n,f,h){i=i.popup.element;i.addClass("waiting");c("button",i).attr("disabled","disabled");var g=c("<div class='throbber'></div>");i.append(g);var m=Raphael.spinner(g[0],100,"#666");function j(o){h(o);i.removeClass("waiting");m();c("button",i).attr("disabled","")}c.ajax({url:contextPath+"/pages/movepage.action",type:"GET",dataType:"json",data:new b(k,l,n,f),error:function(){j(AJS.params.movePageDialogMoveFailed)},success:function(o){var p=[].concat(o.validationErrors||[]).concat(o.actionErrors||[]).concat(o.errorMessage||[]);if(p.length>0){j(p);return}window.location.href=contextPath+o.page.url+(o.page.url.indexOf("?")>=0?"&":"?")+"moved=true"}})}c("#action-move-page-dialog-link").click(function(f){f.preventDefault();if(c("#move-page-dialog").length>0){c("#move-page-dialog, body > .shadow, body > .aui-blanket").remove()}new d({moveHandler:a});return false});c("#edit-move-page-dialog-link").click(function(f){f.preventDefault();if(c("#move-page-dialog").length>0){c("#move-page-dialog, body > .shadow, body > .aui-blanket").remove()}new d({spaceKey:c("#newSpaceKey").val(),spaceName:c("#space_content").text(),parentPageTitle:c("#parentPageString").val(),buttonName:AJS.params.movePageDialogMoveButton,title:AJS.params.movePageDialogEditPageTitle,moveHandler:function(j,g,k,l,i,h,e){c("#space_content").text(k);c("#newSpaceKey").val(g);c("#parentPageString").val(l);c("#parent_content").text(l);if(l!=""){c("#position").val("append");c("#parent_info").removeClass("hidden")}else{c("#parent_info").addClass("hidden");c("#position").val("topLevel")}if(i){c("#targetId").val(i);c("#position").val(h)}j.remove()},pageTitleAccessor:function(){return c("#content-title").val()}});return false})});